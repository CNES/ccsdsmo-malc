<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>MAL - MAL C API</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">MAL C API</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../tutorial/">Tutorial</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MAL APIs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../mal_attributes/">Attributes</a>
</li>

                        
                            
<li >
    <a href="../mal_encoding/">Encoding</a>
</li>

                        
                            
<li class="active">
    <a href="./">MAL</a>
</li>

                        
                            
<li >
    <a href="../mal_transport/">Transport</a>
</li>

                        
                            
<li >
    <a href="../area/">Area</a>
</li>

                        
                            
<li >
    <a href="../mal_actor/">Actor</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Transports <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../mal_czmq/">MAL/CZMQ</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Generators <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../stub_generator/">Stubs generator</a>
</li>

                        
                            
<li >
    <a href="../malbinary_generator/">MalBinary</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../annexes/">Annexs</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../mal_encoding/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../mal_transport/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#mal-api">MAL API</a></li>
        
            <li><a href="#definition">Definition</a></li>
        
            <li><a href="#contexte-mal">Contexte MAL</a></li>
        
            <li><a href="#mal-message">MAL message</a></li>
        
            <li><a href="#end-point-mal">End-Point MAL</a></li>
        
            <li><a href="#mal-poller">MAL Poller</a></li>
        
            <li><a href="#mal-handler-and-routing">MAL Handler and routing</a></li>
        
            <li><a href="#element-union">Element union</a></li>
        
            <li><a href="#element-holder">Element holder</a></li>
        
            <li><a href="#list-of-non-pointer-attribute">List of non-pointer attribute</a></li>
        
            <li><a href="#list-of-pointer-attribute">List of pointer attribute</a></li>
        
            <li><a href="#list-of-composite">List of Composite</a></li>
        
            <li><a href="#list-of-enumerated">List of Enumerated</a></li>
        
            <li><a href="#interaction-stage">Interaction stage</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="mal-api">MAL API</h1>
<p>MAL API allows the use of MAL-level concepts:</p>
<ul>
<li>concepts defined by the MAL specification (Blue Book).</li>
<li>specific concepts to the C API, defined in section 2.</li>
</ul>
<p>The MAL API contains the Area API generated from the definition of the MAL Area.</p>
<h2 id="definition">Definition</h2>
<pre><code class="c">mal.h
</code></pre>

<h3 id="virtual-function-to-create-an-uri">Virtual function to create an URI</h3>
<p>Function to be provided by a MAL binding to create a URI.</p>
<p>Declaration:</p>
<pre><code class="c">typedef mal_uri_t *mal_binding_ctx_create_uri_fn(
  void *mal_binding_ctx,
  char *id);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings. </li>
<li><code>id</code>: unique identifier to include in the created URI.</li>
</ul>
<p>Result: </p>
<ul>
<li>Created URI.</li>
</ul>
<h3 id="virtual-function-to-create-an-end-point">Virtual function to create an end-point</h3>
<p>Function to be provided by a MAL binding to create an end-point.</p>
<p>Declaration:</p>
<pre><code class="c">typedef void *mal_binding_ctx_create_endpoint_fn(
  void *mal_binding_ctx,
  mal_endpoint_t *mal_endpoint);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>mal_endpoint</code>: MAL end-point corresponding to the physical transport end-point to create.</li>
</ul>
<p>Result:</p>
<ul>
<li>The pointer to the physical end-point created (untyped to allow the use of multiple bindings, for example ZMQ socket).</li>
</ul>
<h3 id="virtual-function-to-delete-an-end-point">Virtual function to delete an end-point</h3>
<p>Function to be provided by a MAL binding to destroy an end-point.</p>
<p>Declaration:</p>
<pre><code class="c">typedef void mal_binding_ctx_destroy_endpoint_fn(
  void *mal_binding_ctx,
  void **endpoint_p);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>endpoint_p</code>: the end-point to delete.</li>
</ul>
<h3 id="virtual-function-to-create-a-poller">Virtual function to create a poller</h3>
<p>Function to be provided by a MAL binding to create a poller.</p>
<p>Declaration:</p>
<pre><code class="c">typedef void *mal_binding_ctx_create_poller_fn(
  void *mal_binding_ctx,
  mal_poller_t *mal_poller);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>mal_poller</code>: the MAL poller corresponding to the physical transport poller to create.</li>
</ul>
<p>Result: </p>
<ul>
<li>The pointer to the physical poller created (untyped to allow the use of multiple bindings, for example ZMQ zpoller).</li>
</ul>
<h3 id="virtual-function-to-destroy-a-poller">Virtual function to destroy a poller</h3>
<p>Function to be provided by a MAL binding to destroy a poller.</p>
<p>Declaration:</p>
<pre><code class="c">typedef void mal_binding_ctx_destroy_poller_fn(
  void *mal_binding_ctx,
  void **poller_p);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>poller_p</code>: poller to destroy.</li>
</ul>
<h3 id="virtual-function-to-add-resp-remove-an-end-point-to-a-poller">Virtual function to add (resp. remove) an end-point to a poller</h3>
<p>Functions to be provided by a MAL binding to add or remove an end-point to a poller.</p>
<p>Declaration:</p>
<pre><code class="c">typedef int mal_binding_ctx_poller_add_endpoint_fn(
    void *mal_binding_ctx,
    mal_poller_t *mal_poller,
    mal_endpoint_t *mal_endpoint);

typedef int mal_binding_ctx_poller_del_endpoint_fn(
    void *mal_binding_ctx,
    mal_poller_t *mal_poller,
    mal_endpoint_t *mal_endpoint);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>mal_poller</code>: MAL poller to use.</li>
<li><code>mal_endpoint</code>: MAL end-point to add (resp. remove) to the specified poller.</li>
</ul>
<p>Result:</p>
<ul>
<li>an error code.</li>
</ul>
<h3 id="virtual-function-for-waiting-a-message-on-a-poller">Virtual function for waiting a message on a poller</h3>
<p>Function to be provided by a MAL binding to wait on a poller.</p>
<p>Declaration:</p>
<pre><code class="c">typedef int mal_binding_ctx_poller_wait_fn(
    void *mal_binding_ctx,
    mal_poller_t *mal_poller,
    mal_endpoint_t **mal_endpoint,
    int timeout);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>mal_poller</code>: MAL poller to use.</li>
<li><code>mal_endpoint</code>: MAL end-point on which a message is pending.</li>
<li><code>timeout</code>: the maximum waiting time, possibly infinite (-1).</li>
</ul>
<p>Result:</p>
<ul>
<li>an error code.</li>
</ul>
<h3 id="virtual-function-to-send-a-message">Virtual function to send a message</h3>
<p>Function to be provided by a MAL binding to send a message.
This function is called by <code>mal_ctx_send_message</code> (see section 7.4.2).</p>
<p>Declaration:</p>
<pre><code class="c">typedef int mal_binding_ctx_send_message_fn(
    void *mal_binding_ctx,
    mal_endpoint_t *mal_endpoint,
    mal_message_t *message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>mal_endpoint</code>: MAL end-point sending the message.</li>
<li><code>message</code>: MAL message to send.</li>
</ul>
<p>Result:</p>
<ul>
<li>an error code.</li>
</ul>
<h3 id="virtual-function-to-receive-a-message">Virtual function to receive a message</h3>
<p>Function to be provided by a MAL binding to receive a message.
This function is called by <code>mal_ctx_recv_message</code> (see section 7.4.3).</p>
<p>Declaration:</p>
<pre><code class="c">typedef int mal_binding_ctx_recv_message_fn(
  void *mal_binding_ctx,
  mal_endpoint_t *mal_endpoint,
  mal_message_t **message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>mal_endpoint</code>: MAL end-point receiving the message.</li>
<li><code>message</code>: receiving message.</li>
</ul>
<p>Result:</p>
<ul>
<li>an error code.</li>
</ul>
<h3 id="virtual-function-to-delete-a-mal-message">Virtual function to delete a MAL message</h3>
<p>Function to be provided by a MAL binding to destroy a message.
Allows the transport to free resources (field <code>body_owner</code>) that it has associated with the message before its destruction.</p>
<p>Declaration:</p>
<pre><code class="c">typedef int mal_binding_ctx_destroy_message_fn(
    void *mal_binding_ctx,
    mal_message_t *message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_binding_ctx</code>: transport context (binding) used by the MAL layer; untyped to allow the use of multiple bindings.</li>
<li><code>message</code>: MAL message to delete.</li>
</ul>
<p>Result:</p>
<ul>
<li>an error code.</li>
</ul>
<h2 id="contexte-mal">Contexte MAL</h2>
<pre><code class="c">mal_ctx.h
</code></pre>

<h3 id="constructor">Constructor</h3>
<p>Declaration:</p>
<pre><code class="c">mal_ctx_t *mal_ctx_new(void);
</code></pre>

<p>Result: </p>
<ul>
<li>The created MAL context.</li>
</ul>
<h3 id="uri-creation">URI creation</h3>
<p>Declaration:</p>
<pre><code class="c">mal_uri_t *mal_ctx_create_uri(mal_ctx_t *self, char *id);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: MAL context.</li>
<li><code>id</code>: unique identifier in the transport context.</li>
</ul>
<p>Result: </p>
<ul>
<li>The created URI.</li>
</ul>
<h3 id="poller-creation">Poller creation</h3>
<p>Declaration:</p>
<pre><code class="c">void *mal_ctx_create_poller(
  mal_ctx_t *self,
  mal_poller_t *poller);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: MAL context.</li>
<li><code>poller</code>: MAL poller corresponding to the new physical poller.</li>
</ul>
<p>Result: </p>
<ul>
<li>A pointer to the created physical poller (untyped to avoid dependence with physical concepts of transport, for example a ZMQ zpoller).</li>
</ul>
<h3 id="end-point-creation">end-point creation</h3>
<p>Declaration:</p>
<pre><code class="c">void *mal_ctx_create_endpoint(
  mal_ctx_t *self,
  mal_endpoint_t *endpoint);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: MAL context.</li>
<li><code>endpoint</code>: MAL end-point corresponding to the new physical end-point.</li>
</ul>
<p>Result: </p>
<ul>
<li>A pointer to the created physical end-point (untyped to avoid dependence with physical concepts of transport, for example a ZMQ socket).</li>
</ul>
<h3 id="mal-message-sending">MAL message sending</h3>
<p>This function is used by message sending functions of MAL end-points (section 7.4.2). It calls the message sending function offered by the underlying transport (section 7.1.8).</p>
<p>The use of this function is restricted to MAL end-point.</p>
<p>Declaration:</p>
<pre><code class="c">int mal_ctx_send_message(
  mal_ctx_t *self,
  mal_endpoint_t *mal_endpoint,
  mal_message_t *message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: MAL context.</li>
<li><code>mal_endpoint</code>: MAL end-point sending the message.</li>
<li><code>message</code>: MAL message to send.</li>
</ul>
<p>Result:</p>
<ul>
<li>an error code.</li>
</ul>
<h3 id="mal-message-reception">MAL message reception</h3>
<p>This function is used by the message receiving functions of MAL end-points (section 7.4.3). It calls the message receiving function offered by underlying transport (7.1.9).</p>
<p>The use of this function is restricted to MAL end-point.</p>
<p>Declaration:</p>
<pre><code class="c">int mal_ctx_recv_message(
  mal_ctx_t *self,
  mal_endpoint_t *mal_endpoint,
  mal_message_t **message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: MAL context.</li>
<li><code>mal_endpoint</code>: MAL end-point receiving the message.</li>
<li><code>message</code>: MAL message received.</li>
</ul>
<p>Result:</p>
<ul>
<li>an error code.</li>
</ul>
<h3 id="destructor">Destructor</h3>
<p>Deletes the MAL context.</p>
<pre><code class="c">  void mal_ctx_destroy(mal_ctx_t **self_p);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self_p</code>: Handle to the MAL context to delete.</li>
</ul>
<h2 id="mal-message">MAL message</h2>
<h3 id="constructor_1">Constructor</h3>
<p>Allocate the memory chunk needed for the message body.</p>
<p>Declaration:</p>
<pre><code class="c">mal_message_t *mal_message_new(
  mal_blob_t *authentication_id,
  mal_qoslevel_t qoslevel, mal_uinteger_t priority, mal_list_t *domain,
  mal_identifier_t *network_zone, mal_sessiontype_t session,
  mal_identifier_t *session_name, unsigned int body_length);
</code></pre>

<p>Parameters:</p>
<ul>
<li>MAL header fields.</li>
<li>Message body size in bytes.</li>
</ul>
<p>Result:</p>
<ul>
<li>The new MAL message.</li>
</ul>
<h3 id="initialisation">Initialisation</h3>
<p>Initialization of the header fields corresponding to the operation and interaction stage.</p>
<p>Declaration:</p>
<pre><code class="c">void mal_message_init(mal_message_t *self, mal_ushort_t service_area,
  mal_uoctet_t area_version, mal_ushort_t service,
  mal_ushort_t operation,
  mal_interactiontype_t interaction_type,
  mal_uoctet_t interaction_stage);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: a pointer to the MAL message to initialize.</li>
<li>MAL header fields.</li>
</ul>
<h3 id="destructor_1">Destructor</h3>
<p>Deletes the MAL message and the corresponding body.
Calls the virtual function provided by the transport API.
Declaration:</p>
<pre><code class="c">void mal_message_destroy(mal_message_t **self_p, mal_ctx_t *mal_ctx);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: an handle to the MAL message to destroy.</li>
<li>The MAL context needed to free associated resources in transport binding if needed.</li>
</ul>
<h3 id="getters-et-setters">Getters et setters</h3>
<p>The fields defined in the following table are accessible through getter and setter methods.</p>
<table>
<thead>
<tr>
<th>Champ</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;mal header field&gt;</code></td>
<td><code>&lt;mal header field type&gt;</code></td>
<td>MAL header fields as described in the MAL blue book.</td>
</tr>
<tr>
<td><code>free_&lt;header field&gt;</code></td>
<td><code>bool</code></td>
<td>Flags indicating whether the corresponding MAL header fields of type pointer must be destroyed when the MAL message is deleted.</td>
</tr>
<tr>
<td><code>body</code></td>
<td><code>char *</code></td>
<td>Message Body encoded.</td>
</tr>
<tr>
<td><code>body_offset</code></td>
<td><code>unsigned int</code></td>
<td>Start offset of the message body.</td>
</tr>
<tr>
<td><code>body_length</code></td>
<td><code>unsigned int</code></td>
<td>Size of the message body.</td>
</tr>
<tr>
<td><code>body_owner</code></td>
<td><code>void *</code></td>
<td>Resource associated with the message by the transport. Should be released during the destruction of the message.</td>
</tr>
</tbody>
</table>
<p>Presence flags apply to the following fields: <code>URI To</code>, <code>Authentication Id</code>, <code>URI From</code>, <code>Domain</code>, <code>Network Zone</code>, <code>Session Name</code>.
By default, the behavior is:</p>
<ul>
<li>If the MAL message is created through the constructor then the flag is false. The MAL header fields are transmitted by the application when calling the constructor, so they do not have to be released.</li>
<li>If the MAL message is created by the transport during a reception and if the header fields have been decoded (not recovered from a configuration service) then the flag is true. The MAL header fields are owned by the message and should be destroyed with it.</li>
</ul>
<h2 id="end-point-mal">End-Point MAL</h2>
<p>Each endpoint should be handled by a single execution flow.</p>
<h3 id="constructor_2">Constructor</h3>
<p>Create an endpoint instance identified by a MAL URI.
A <code>Transaction Id</code> counter is managed.</p>
<p>Declaration:</p>
<pre><code class="c">mal_endpoint_t *mal_endpoint_new(mal_ctx_t *mal_ctx, mal_uri_t *uri);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_ctx</code>: a pointer to the MAL context.</li>
<li><code>uri</code>: MAL URI identifying the MAL endpoint.</li>
</ul>
<p>The API provides two functions to retrieve the URL and context MAL corresponding to an end-point:</p>
<pre><code class="c">mal_uri_t *mal_endpoint_get_uri(mal_endpoint_t *self);
mal_ctx_t *mal_endpoint_get_mal_ctx(mal_endpoint_t *self);
</code></pre>

<h3 id="mal-message-sending_1">MAL message sending</h3>
<p>Two message sending functions are defined:</p>
<ul>
<li>A funtion to initiate an interaction (first stage). This function sets the URI fields of the message: the destination URI of the message is set with the <code>uri_to</code> parameter, and the source URI of the message is set with the endpoint URI. If the <code>set_tid</code> flag is true then the <code>Transaction Id</code> field is set with the next value of the <code>TransactionId</code> counter handled by the endpoint. Otherwise the original value of the <code>Transaction Id</code> field is left unchanged.</li>
<li>A function for the next stages of the interaction. This function sets the URI fields of the message: the destination URI of the message is set with the <code>uri_from</code> field of the initiation message, and the source URI of the message is set with the endpoint URI. The <code>Transaction Id</code> field of the message is set with the <code>Transaction Id</code> field of the initiation message. The field <code>Is Error Message</code> is set with the value of the <code>is_error_message</code> parameter. counter.</li>
</ul>
<p>The <code>mal_ctx_send_message</code> function (section 7.2.5) is called to send the MAL message.</p>
<p>Declaration:</p>
<pre><code class="c">int mal_endpoint_init_operation(
  mal_endpoint_t *self,
  mal_message_t *message,
  mal_uri_t *uri_to,
  bool set_tid);

int mal_endpoint_return_operation(
  mal_endpoint_t *self,
  mal_message_t *init_message,
  mal_message_t *message,
  bool is_error_message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: A pointer to the MAL endpoint sending the message.</li>
<li><code>message</code>: A pointer to the MAL message to send.</li>
<li><code>init_message</code>: A pointer to the MAL message initiating the interaction.</li>
<li><code>uri_to</code>: The MAL URI of the message recipient.</li>
<li><code>set_tid</code>: Boolean indicating whether the field 'Transaction ID' of the message MAL should be affected or not.</li>
<li><code>is_error_message</code>:  Boolean indicating whether the message returns an error</li>
</ul>
<p>Result: </p>
<p>Error code.</p>
<h3 id="mal-message-reception_1">MAL message reception</h3>
<p>The <code>mal_endpoint_recv_message</code> function allows to receive a message on the end-point.
This function blocks until receiving a message.</p>
<p>Declaration:</p>
<pre><code class="c">int mal_endpoint_recv_message(
    mal_endpoint_t *self,
    mal_message_t **message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: A pointer to the MAL endpoint waiting for a message.</li>
<li><code>message</code>: The message received.</li>
</ul>
<p>Result: </p>
<p>Error code.</p>
<h3 id="destructor_2">Destructor</h3>
<p>Delete the endpoint.</p>
<p>Declaration:</p>
<pre><code class="c">void mal_endpoint_destroy(mal_endpoint_t **self_p);
</code></pre>

<h2 id="mal-poller">MAL Poller</h2>
<p>Each MAL poller should be handled by a single execution flow.</p>
<h3 id="constructor_3">Constructor</h3>
<p>Create a poller instance identified by a MAL URI.</p>
<p>Declaration:</p>
<pre><code class="c">  mal_poller_t *mal_poller_new(mal_ctx_t *mal_ctx);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>mal_ctx</code>: A pointer to the MAL context.</li>
</ul>
<p>The API provides a function to retrieve the MAL context corresponding to the poller:</p>
<pre><code class="c">mal_ctx_t *mal_poller_get_mal_ctx(mal_poller_t *self);
</code></pre>

<h3 id="add-remove-mal-endpoint">Add / Remove MAL endpoint</h3>
<p>Twos functions allow to add and remove a endpoint to the poller.</p>
<p>Declaration:</p>
<pre><code class="c">int mal_poller_add_endpoint(
    mal_poller_t *self,
    mal_endpoint_t *endpoint);

int mal_poller_del_endpoint(
    mal_poller_t *self,
    mal_endpoint_t *mal_endpoint);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: A pointer to the MAL poller.</li>
<li><code>endpoint</code>: A pointer to the MAL endpoint to add or remove.</li>
</ul>
<p>Result:</p>
<p>Error code.</p>
<h3 id="attente-de-message-mal">Attente de message MAL</h3>
<p><code>mal_poller_wait</code> function allows to wait the reception of a MAL message on one of the endpoint handled by the poller.
This is a blocking function, it takes a time-out parameter.</p>
<p>Declaration:</p>
<pre><code class="c">int mal_poller_wait(
    mal_poller_t *self,
    mal_endpoint_t **endpoint,
    int timeout);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: A pointer to the poller waiting a MAL message.</li>
<li><code>endpoint</code>: An handle to the endpoint which received a message.</li>
<li><code>timeout</code>: The maximum waiting time, possibly infinite (-1).</li>
</ul>
<p>Result:</p>
<p>Error code.</p>
<h3 id="destructor_3">Destructor</h3>
<p>Deletes the MAL poller. The associated endpoint should be destroyed explicitly.</p>
<p>Declaration:</p>
<pre><code class="c">  void mal_poller_destroy(mal_oller_t **self_p);
</code></pre>

<h2 id="mal-handler-and-routing">MAL Handler and routing</h2>
<p>A handler is a logical structure composed of a set of MAL message processing functions.
This set of functions depends of its role (provider, consumer, etc.) and interaction in
which it operates (send, submit, etc.). Handlers run in the context of a routing structure
(i e, an object of the class <code>mal_routing</code>, or router).</p>
<p>The router is linked to the MAL endpoint: it allows to register the handlers corresponding
to different expected interactions, then on a message receipt it allows the activatation of
the corresponding handler to handle the message. The router shares its state with all its
handlers.</p>
<h3 id="handler">Handler</h3>
<p>Each message processing function of the handler has the same signature defined below.</p>
<ul>
<li>the state of the router,</li>
<li>a pointer to the MAL context,</li>
<li>a pointer the MAL endpoint,</li>
<li>a pointer to the message to process.</li>
</ul>
<p>The corresponding signature is.</p>
<p>Declaration:</p>
<pre><code class="c">typedef int mal_routing_on_message_fn(
  void *self,
  mal_ctx_t *mal_ctx,
  mal_endpoint_t *mal_endpoint,
  mal_message_t *message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>state</code>: The state of the router (untyped to allow polymorphism).</li>
<li><code>mal_ctx</code>: A pointer to the MAL context.</li>
<li><code>endpoint</code>: A pointer to the MAL endpoint.</li>
<li><code>message</code>: A pointer to the message to process.</li>
</ul>
<h3 id="constructor_4">Constructor</h3>
<p>Create a router instance identified by the corresponding endpoint URI.
Normally only a single router must be associated with a given MAL endpoint.</p>
<p>Declaration:</p>
<pre><code class="c">mal_routing_t *mal_routing_new(mal_endpoint_t *endpoint, void *state);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>endpoint</code>: A pointer to the MAL endpoint.</li>
<li><code>state</code>: The state of the router (untyped to allow polymorphism).</li>
</ul>
<h3 id="handlers-registering">Handlers registering</h3>
<p>The MAL router interface defines the set of functions for registering the interaction's handlers.
Each function takes as parameters a pointer to the router's state itself, the identification of the area, version, identity of service and operation. Depending on the role of the handler and the operation type, the interface includes pointers to the functions allowing to process the messages corresponding to the interaction.</p>
<p>L'interface defines a function to register an handler of <em>Send</em> interaction, and two functions to register the <em>provider</em> and <em>consumer</em> handlers of each interactions <em>Submit</em>, <em>Request</em>, <em>Invoke</em> et <em>Progress</em>:</p>
<pre><code class="c">int mal_routing_register_provider_send_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_send);

int mal_routing_register_provider_submit_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_submit);

int mal_routing_register_consumer_submit_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_ack);

int mal_routing_register_provider_request_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_request);

int mal_routing_register_consumer_request_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_response);

int mal_routing_register_provider_invoke_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_invoke);

int mal_routing_register_consumer_invoke_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_ack,
    mal_routing_on_message_fn *on_response);

int mal_routing_register_provider_progress_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_progress);

int mal_routing_register_consumer_progress_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_ack,
    mal_routing_on_message_fn *on_update,
    mal_routing_on_message_fn *on_response);
</code></pre>

<p>L'interface also offers three functions to register <em>publisher</em>, <em>subscriber</em> and <em>broker</em> handlers for <em>Publish/Subscribe</em> interaction:</p>
<pre><code class="c">int mal_routing_register_provider_pubsub_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_publish_error,
    mal_routing_on_message_fn *on_publish_register_ack,
    mal_routing_on_message_fn *on_publish_deregister_ack);

int mal_routing_register_consumer_pubsub_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_register_ack,
    mal_routing_on_message_fn *on_deregister_ack,
    mal_routing_on_message_fn *on_notify);

int mal_routing_register_broker_pubsub_handler(
    mal_routing_t *mal_routing,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation,
    mal_routing_on_message_fn *on_notify_error,
    mal_routing_on_message_fn *on_register,
    mal_routing_on_message_fn *on_deregister,
    mal_routing_on_message_fn *on_publish);
</code></pre>

<p>Finally, the interface also provides a function to deregister a <em>handler</em>:</p>
<pre><code class="c">int mal_routing_remove_handler(
    mal_routing_t *mal_routing,
    handler_type_t type,
    mal_ushort_t area, mal_uoctet_t area_version,
    mal_ushort_t service, mal_ushort_t operation);
</code></pre>

<h3 id="handlers-execution">Handlers execution</h3>
<p>The <em>router</em> interface provides a function to activate the rigth handler when receiving a MAL message.
When called this function search the right handler in the list of registered handlers. If successful it
activates the handler by calling the function corresponding to the received message.</p>
<p>Declaration:</p>
<pre><code class="c">int mal_routing_handle(mal_routing_t *self, mal_message_t *message);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code>: A pointer to the <em>router</em>.</li>
<li><code>message</code>: A pointer to the received message.</li>
</ul>
<h3 id="destructor_4">Destructor</h3>
<p>Deletes the <em>router</em> and its state.</p>
<pre><code class="c">void mal_routing_destroy(mal_routing_t **self_p);
</code></pre>

<h2 id="element-union">Element union</h2>
<p>A <code>mal_element_t</code>  union is defined to allow the polymorphism of <em>Element</em>.</p>
<pre><code class="c">union mal_element_t {
  mal_blob_t *blob_value;
  mal_boolean_t boolean_value;
  mal_double_t double_value;
  mal_float_t float_value;
  mal_octet_t octet_value;
  mal_uoctet_t uoctet_value;
  mal_short_t short_value;
  mal_ushort_t ushort_value;
  mal_integer_t integer_value;
  mal_uinteger_t uinteger_value;
  mal_long_t long_value;
  mal_ulong_t ulong_value;
  mal_string_t *string_value;
  mal_identifier_t *identifier_value;
  mal_uri_t *uri_value;
  mal_time_t time_value;
  mal_finetime_t finetime_value;
  mal_duration_t duration_value;
  int enumerated_value;
  void *composite_value;
  void *list_value;
};
</code></pre>

<h2 id="element-holder">Element holder</h2>
<p>This structure allows to manage the decoding in case of element polymorphism.</p>
<h3 id="constructor_5">Constructor</h3>
<p>Declaration:</p>
<pre><code class="c">mal_element_holder_t *mal_element_holder_new(void);
</code></pre>

<h3 id="getters-et-setters_1">Getters et setters</h3>
<p>Declaration:</p>
<pre><code class="c">bool mal_element_holder_get_presence_flag(mal_element_holder_t *self);

void mal_element_holder_set_presence_flag(mal_element_holder_t *self,
  bool presence_flag);

long mal_element_holder_get_short_form(mal_element_holder_t *self);

void mal_element_holder_set_short_form(mal_element_holder_t *self,
  long short_form);

union mal_element_t mal_element_holder_get_value(
  mal_element_holder_t *self);

void mal_element_holder_set_value(mal_element_holder_t *self,
  union mal_element_t value);
</code></pre>

<h3 id="destructor_5">Destructor</h3>
<p>This destructor frees only space allocated for the structure itself, not the union elements.</p>
<p>Declaration:</p>
<pre><code class="c">void mal_element_holder_destroy(mal_element_holder_t **self_p);
</code></pre>

<h2 id="list-of-non-pointer-attribute">List of non-pointer attribute</h2>
<p>Data structures defined to represent lists of <em>attribute</em> types which are not represented by a <em>C</em> pointer
(see section 2.6). These lists are specific to each type of non-pointer <em>Attribute</em>.
For each list, two tables are defined:</p>
<ul>
<li><code>presence_flags</code>: Table of presence flags for each of the items in the list.</li>
<li><code>content</code>: Table containing the values of each item of the list; if an item is null, its value in the
  table can be assigned with any value.</li>
</ul>
<p>The size of <code>presence_flags</code> and <code>content</code> tables should be the same.</p>
<h3 id="constructor_6">Constructor</h3>
<p>Declaration:</p>
<pre><code class="c">mal_&lt;attribute&gt;_list_t *mal_&lt;attribute&gt;_list_new(
  unsigned int element_count);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>element_count</code>: Number of items in the list.</li>
</ul>
<h3 id="getter">Getter</h3>
<p>Getter functions are defined to access the fields:</p>
<pre><code class="c">unsigned int mal_&lt;attribute&gt;_list_get_element_count(
  mal_&lt;attribute&gt;_list_t *self);

bool *mal_&lt;attribute&gt;_list_get_presence_flags(
  mal_&lt;attribute&gt;_list_t *self);

mal_&lt;attribute&gt;_t *mal_&lt;attribute&gt;_list_get_content(
  mal_&lt;attribute&gt;_list_t *self);
</code></pre>

<h3 id="destructor_6">Destructor</h3>
<p>Deletes the list and its contents (<code>presence_flags</code> and <code>content</code> tables).</p>
<p>Declaration:</p>
<pre><code class="c">void mal_&lt;attribute&gt;_list_destroy(mal_&lt;attribute&gt;_list_t **self_p);
</code></pre>

<h2 id="list-of-pointer-attribute">List of pointer attribute</h2>
<p>Data structures defined to represent lists of <em>attribute</em> types which are represented by a <em>C</em> pointer
(see section 2.6).</p>
<h3 id="constructor_7">Constructor</h3>
<p>Declaration:</p>
<pre><code class="c">mal_&lt;attribute&gt;_list_t *mal_&lt;attribute&gt;_list_new(
  unsigned int element_count);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>element_count</code>: Number of items in the list.</li>
</ul>
<h3 id="getters">Getters</h3>
<p>Getter functions are defined to access the fields:</p>
<pre><code class="c">unsigned int mal_&lt;attribute&gt;_list_get_element_count(
  mal_&lt;attribute&gt;_list_t *self);

mal_&lt;attribute&gt;_t **mal_&lt;attribute&gt;_list_get_content(
  mal_&lt;attribute&gt;_list_t *self);
</code></pre>

<h3 id="destructor_7">Destructor</h3>
<p>Deletes the list, its contents (pointers table) and the list items.</p>
<p>Declaration:</p>
<pre><code class="c">void mal_&lt;attribute&gt;_list_destroy(mal_&lt;attribute&gt;_list_t **self_p);
</code></pre>

<h2 id="list-of-composite">List of Composite</h2>
<p>Cf section 9.6.</p>
<h2 id="list-of-enumerated">List of Enumerated</h2>
<p>Cf section 9.7.</p>
<h2 id="interaction-stage">Interaction stage</h2>
<p>A constant is defined for each stage of each interaction:</p>
<pre><code class="c">#define MAL_IP_STAGE_SEND 1
#define MAL_IP_STAGE_SUBMIT 1
#define MAL_IP_STAGE_SUBMIT_ACK 2
#define MAL_IP_STAGE_REQUEST 1
#define MAL_IP_STAGE_REQUEST_RESPONSE 2
#define MAL_IP_STAGE_INVOKE 1
#define MAL_IP_STAGE_INVOKE_ACK 2
#define MAL_IP_STAGE_INVOKE_RESPONSE 3
#define MAL_IP_STAGE_PROGRESS 1
#define MAL_IP_STAGE_PROGRESS_ACK 2
#define MAL_IP_STAGE_PROGRESS_UPDATE 3
#define MAL_IP_STAGE_PROGRESS_RESPONSE 4
#define MAL_IP_STAGE_PUBSUB_REGISTER 1
#define MAL_IP_STAGE_PUBSUB_REGISTER_ACK 2
#define MAL_IP_STAGE_PUBSUB_PUBLISH_REGISTER 3
#define MAL_IP_STAGE_PUBSUB_PUBLISH_REGISTER_ACK 4
#define MAL_IP_STAGE_PUBSUB_PUBLISH 5
#define MAL_IP_STAGE_PUBSUB_NOTIFY 6
#define MAL_IP_STAGE_PUBSUB_DEREGISTER 7
#define MAL_IP_STAGE_PUBSUB_DEREGISTER_ACK 8
#define MAL_IP_STAGE_PUBSUB_PUBLISH_DEREGISTER 9
#define MAL_IP_STAGE_PUBSUB_PUBLISH_DEREGISTER_ACK 10
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
