<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Encoding - MAL C API</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">MAL C API</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../tutorial/">Tutorial</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MAL APIs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../mal_attributes/">Attributes</a>
</li>

                        
                            
<li class="active">
    <a href="./">Encoding</a>
</li>

                        
                            
<li >
    <a href="../mal_api/">MAL</a>
</li>

                        
                            
<li >
    <a href="../mal_transport/">Transport</a>
</li>

                        
                            
<li >
    <a href="../area/">Area</a>
</li>

                        
                            
<li >
    <a href="../mal_actor/">Actor</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Transports <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../mal_czmq/">MAL/ZMQ</a>
</li>

                        
                            
<li >
    <a href="../mal_tcp/">MAL/TCP</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Generators <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../stub_generator/">Stubs generator</a>
</li>

                        
                            
<li >
    <a href="../malbinary_generator/">MalBinary</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../annexes/">Annexs</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../mal_attributes/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../mal_api/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#encoding-apis">encoding APIs</a></li>
        
            <li><a href="#definitions">Definitions</a></li>
        
            <li><a href="#data-to-encode">Data to encode</a></li>
        
            <li><a href="#encoder">Encoder</a></li>
        
            <li><a href="#decoder">Decoder</a></li>
        
            <li><a href="#format-malbinary-and-malsplitbinary">Format malbinary and malsplitbinary</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="encoding-apis">encoding APIs</h1>
<p>Based on our experience of the MalBinary and MalSplitBinary formats, we propose a generic encoding API for all encoding formats.
If it is not suitable to a particular encoding format, it is still possible to define format specific functions. For that reason the generated encoding functions may use code specific to the encoding format.</p>
<p>The user code does not depend on specific encoding APIs, except when the application needs to encode or decode data explicitely.</p>
<p>The encoding functions generated for each data structure may call either the generic encoding functions or possible format specific functions. The stub generator knows the specificities of each format. It may call the format specific functions, or produce format specific code.</p>
<p>The C name for the encoding format defined in the MAL/SPP book is: <code>malbinary</code>.
The C name for the encoding format defined in the MAL/TCP book is: <code>malsplitbinary</code>.
Those names are strings used in the naming of the APIs.</p>
<h2 id="definitions">Definitions</h2>
<pre><code class="c">    &lt;format&gt;.h
</code></pre>

<p>A code is defined to uniquely identify the encoding format.</p>
<pre><code class="c">    #define &lt;FORMAT&gt;_FORMAT_CODE &lt;unique number&gt;
</code></pre>

<h2 id="data-to-encode">Data to encode</h2>
<p>The data to encode are:</p>
<ul>
<li>MAL attributes (whose C types are defined in section 5)</li>
<li>union type <code>mal_attribute_t</code></li>
<li>format specific data; for example : the presence flag for a nullable field, the size of a list, the value of an enumerated value.</li>
</ul>
<p>Encoding and decoding an error code is performed with the encoding functions for the <code>MAL Uinteger</code> type.</p>
<p>For each data type to encode, three functions are defined:</p>
<ul>
<li>a function to get the size required to encode the data; it accepts the current state of the computed size as input parameter, adds the size of the data, and return the updated size value; the generic API allows for complex size computation, such as the one defined in the split binary encoding;</li>
<li>a function to encode the data in a preallocated buffer;</li>
<li>a function to decode the data.</li>
</ul>
<h2 id="encoder">Encoder</h2>
<pre><code class="c">    mal_encoder.h
</code></pre>

<h3 id="computing-the-encoding-length">Computing the encoding length</h3>
<p>The function adds the encoding length to an initial value given as a parameter.
The length parameter is generalized as a cursor to manage on various encoding formats.
The generic mal_encoder_<em> functions are mapped to specific \<format>_encoder_</em> functions declared in the \<format>_encoder.h file.</p>
<p>Prototype:</p>
<ul>
<li>If the data type is not a pointer (non pointer Attributes or specific data):</li>
</ul>
<pre><code class="c">    int mal_encoder_add_&lt;data&gt;_encoding_length(
      mal_encoder_t *self, mal_&lt;data type&gt;_t to_encode, void *cursor);
</code></pre>

<ul>
<li>If the data type is a pointer (pointer Attributes or specific data):</li>
</ul>
<pre><code class="c">    int mal_encoder_add_&lt;data&gt;_encoding_length(
      mal_encoder_t *self, mal_&lt;data type&gt;_t *to_encode, void *cursor);
</code></pre>

<ul>
<li>For the type <code>MAL::Attribute</code> (polymorphism of Attribute):</li>
</ul>
<pre><code class="c">    int mal_encoder_add_attribute_encoding_length(
      &lt;format&gt;_encoder_t *self, unsigned char attribute_tag,
      union mal_attribute_t to_encode, void *cursor);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code> : the encoding context</li>
<li><code>attribute_tag</code> : the identifier of the Attribute type (with polymorphism of Attribute)</li>
<li><code>to_encode</code> : the data to encode</li>
<li><code>cursor</code> : initial and updated value of the encoding length</li>
</ul>
<p>Result: </p>
<p>Error code</p>
<h3 id="encoding">Encoding</h3>
<p>The function encodes the data in a buffer and at an index defined by the generic cursor parameter.
The generic mal_encoder_<em> functions are mapped to specific \<format>_encoder_</em> functions declared in the \<format>_encoder.h file.
The specific functions cast the generic cursor into a \<format>_cursor_t pointer.</p>
<p>Prototype:</p>
<ul>
<li>If the data type is not a pointer (non pointer Attributes or specific data):</li>
</ul>
<pre><code class="c">    int mal_encoder_encode_&lt;data&gt;(mal_encoder_t *self,
      void *cursor, mal_&lt;data type&gt;_t to_encode);
</code></pre>

<ul>
<li>If the data type is a pointer (pointer Attributes or specific data):</li>
</ul>
<pre><code class="c">    int mal_encoder_encode_&lt;data&gt;(mal_encoder_t *self,
      void *cursor, mal_&lt;data type&gt;_t *to_encode);
</code></pre>

<ul>
<li>For the type <code>MAL::Attribute</code> (polymorphism of Attribute):</li>
</ul>
<pre><code class="c">    int mal_encoder_encode_attribute(
      mal_encoder_t *self, void *cursor,
      unsigned char attribute_tag, mal_attribute_t to_encode);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code> : the encoding context</li>
<li><code>cursor</code> : a virtual index in the encoding structures</li>
<li><code>attribute_tag</code> : the identifier of the Attribute type (with polymorphism of Attribute)</li>
<li><code>to_encode</code> : the data to encode</li>
</ul>
<p>Result: </p>
<p>Error code</p>
<h2 id="decoder">Decoder</h2>
<pre><code class="c">    mal_decoder.h
</code></pre>

<p>A decoding function is defined for each type to decode
The generic mal_decoder_<em> functions are mapped to specific \<format>_decoder_</em> functions declared in the \<format>_decoder.h file.</p>
<p>Prototype:</p>
<ul>
<li>If the data type is not a pointer (non pointer Attributes or specific data):</li>
</ul>
<pre><code class="c">    int mal_decoder_decode_&lt;data&gt;(mal_decoder_t *self,
      void *cursor, mal_&lt;data type&gt;_t *result);
</code></pre>

<ul>
<li>If the data type is a pointer (pointer Attributes or specific data):</li>
</ul>
<pre><code class="c">    int mal_decoder_decode_&lt;data&gt;(mal_decoder_t *self,
      void *cursor, mal_&lt;data type&gt;_t **result);
</code></pre>

<ul>
<li>For the type <code>MAL::Attribute</code> (polymorphism of Attribute):</li>
</ul>
<pre><code class="c">    int mal_decoder_decode_attribute(
      mal_decoder_t *self, void *cursor,
      unsigned char attribute_tag, mal_attribute_t *result);
</code></pre>

<p>Parameters:</p>
<ul>
<li><code>self</code> : the encoding context</li>
<li><code>cursor</code> : a virtual index in the encoding structures</li>
<li><code>attribute_tag</code> : the identifier of the Attribute type (with polymorphism of Attribute)</li>
<li><code>result</code> : the decoded data</li>
</ul>
<p>Result: </p>
<p>Error code</p>
<h2 id="format-malbinary-and-malsplitbinary">Format <strong>malbinary</strong> and <strong>malsplitbinary</strong></h2>
<p>Both formats require similar specific data. They have been declared in the generic encoding API.</p>
<h3 id="specific-data">Specific data</h3>
<table>
<thead>
<tr>
<th>Data</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>presence_flag</code></td>
<td><code>bool</code></td>
<td>Field used for a Nullable element. <code>TRUE</code> when the field is defined (non null value), <code>FALSE</code> when it is not (null value).</td>
</tr>
<tr>
<td><code>list_size</code></td>
<td><code>unsigned int</code></td>
<td>Field defining the size of a MAL list</td>
</tr>
<tr>
<td><code>small_enum</code></td>
<td><code>int</code></td>
<td>Field used for an enumerated value of a small enumeration type (size lower than 2^8)</td>
</tr>
<tr>
<td><code>medium_enum</code></td>
<td><code>int</code></td>
<td>Field used for an enumerated value of a medium enumeration type (size lower than 2^16)</td>
</tr>
<tr>
<td><code>large_enum</code></td>
<td><code>int</code></td>
<td>Field used for an enumerated value of a large enumeration type (size lower than 2^32)</td>
</tr>
<tr>
<td><code>short_form</code></td>
<td><code>long</code></td>
<td>Type identifier defined in section 4.1.2 of the MAL book. It is used in case of general polymorphism.</td>
</tr>
<tr>
<td><code>attribute_tag</code></td>
<td><code>unsigned char</code></td>
<td>Attribute type identifier: <code>short form</code> of the Attribute minus 1 (cf section 5.2.2 of the MAL/SPP book)</td>
</tr>
</tbody>
</table></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
